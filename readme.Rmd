---
title: "Titanic_readme"
author: "Michal Rackiewicz"
date: "2023-09-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

### Load packages and data 

```{r}
library(tidyverse)
library(Hmisc)
library(corrplot)
library(ggpol)
```


```{r titanic data}
train <- read_csv("./Data/train.csv", col_types = "nffcfnnncnf")
test <- read_csv("./Data/test.csv", col_types = "nffcfnnncnf")
```

### Exploratory data analysis

```{r}
str(train)
```

First we will look at the summary statistics for each variable

```{r}
summary(train)
```

Let us also check the distribution of the dependent variable. By doing this we get an idea of how balanced the data set is and whether we have to do something to balance groups before modeling.

```{r}
train %>% 
  select(Survived) %>% 
  group_by(Survived) %>% 
  summarise(n = n()) %>% 
  mutate(Freq = paste0(round(100 * n/sum(n), 1), "%"))
```

We also want to check for missing values.

```{r}
train %>% 
  summarise_all(list(~sum(is.na(.))))
```

We see that although "Age" is the only variable with missing values. We will replace blank cells and those containing only spaces, as well as zeros in Fare with NAs.

```{r}
train$Fare[train$Fare == 0] = NA
```

```{r}
train <- train %>% 
  mutate(across(everything(), ~gsub("^[[:space:]]*$", NA, .)))
```

```{r}
train %>% 
  summarise_all(list(~sum(is.na(.))))
```

Due to too many missing values, we will drop the Cabin column.

```{r}
train <- train %>% select(!Cabin)
```


Let's take a look at the distribution of the variables.
```{r numeric plots, echo=FALSE}
train %>% 
  select(where(is.numeric))%>%
  hist.data.frame(.)
```
We also want to consider the relationship between each variable and survival.
```{r}
str(train)
```

```{r}
train <- train %>% 
  mutate(across(c(PassengerId, Age, SibSp, Parch, Fare), as.integer),
         across(c(Survived, Pclass, Embarked, Sex), as.factor)
         )
```
Let us now inspect the relationships between the variables.
First, we will a plot a correlation map displaying linear relationship between the variables.
```{r}
correlation_matrix <- train %>%
  select(!c(Name, PassengerId, Ticket)) %>%
  mutate(across(where(is.factor), as.numeric)) %>%
  filter(complete.cases(.)) %>% 
  cor(as.matrix(.), method = "spearman")

corrplot(correlation_matrix, 
         method = "number",
         type = "upper",
         order = "hclust")
```
```{r, echo=FALSE}
corrplot(correlation_matrix, 
         method = "square",
         type = "lower",
         order = "FPC",
         addCoef.col = 'black',
         diag = FALSE
         )
```
Let us now take a closer look at those variables which are correlated with survival.
As expected sex is a stong of survival. Let us look at the numbers of survivors based on sex and passenger class.
```{r, echo=FALSE}
ggplot(train, aes(x = interaction(Pclass, Sex),
           fill = Survived)) +
  geom_bar(stat="count",
           width = 0.4,
           position = position_dodge(width = 0.6)) +
  labs(title = "Survival based on Passenger Class and Sex",
       y = "Count",
       x = "Class/Sex",
       fill = "Survived") +
  theme_minimal()
```

```{r}
train %>% 
  filter(Survived == 1) %>%
  ggplot(aes(x = Pclass, y = Age))+
  geom_boxjitter(aes(fill = Sex),
                 position = position_dodge(width = 0.8),
                 width = 0.3,
                 jitter.shape = 21,
                 jitter.color = NA,
                 outlier.shape = 1,
                 errorbar.draw = TRUE,
                 errorbar.length = 0.4)+
  labs(title = "Age of survivors based on Class and Sex",
       y = "Age",
       x = "Class",
       fill = "Sex",
       color = "Sex",
       shape = "Survived")+
  theme_minimal()
```

Passenger class and fare are strongly negatively correlated, i.e. the highest fares are found in class 1.
```{r, echo=FALSE}
ggplot(train, aes(x = Pclass,
                  y = Fare,
                  fill = Pclass)) +
  geom_boxplot() +
  labs(title = "Fare in each passenger class",
       y = "Fare",
       x = "Class") +
  theme_minimal()
```




```{r}
train %>% 
  group_by(Survived) %>% 
  summarise(across(c(Pclass, Sex, SibSp, Parch, Embarked), ~n()))
  
```

